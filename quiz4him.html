<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Multi-Level Quiz App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        transition: background-color 0.5s ease, color 0.5s ease;
      }
      .sidebar {
        transition: transform 0.3s ease-in-out;
      }
      .backdrop {
        transition: opacity 0.3s ease-in-out;
      }
      .gradient-bg {
        background: linear-gradient(-45deg, #8c4631, #8a244b, #15627f, #157d66);
        background-size: 400% 400%;
        animation: gradient 15s ease infinite;
        color: white;
      }
      @keyframes gradient {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }
      .glasmorphism {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        transition: background 0.5s ease, border 0.5s ease, box-shadow 0.5s ease;
      }

      /* Light Mode Styles */
      body.light-mode {
        background: linear-gradient(-45deg, #fbc2eb, #a6c1ee, #fbc2eb, #a1c4fd);
        background-size: 400% 400%;
        animation: gradient 15s ease infinite;
        color: #1f2937; /* dark gray */
      }
      .light-mode .glasmorphism {
        background: rgba(255, 255, 255, 0.4);
        border: 1px solid rgba(0, 0, 0, 0.1);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
      }
      .light-mode .text-white {
        color: #1f2937;
      }
      .light-mode .text-gray-200 {
        color: #4b5563;
      }
      .light-mode .text-gray-300 {
        color: #6b7280;
      }
      .light-mode .text-yellow-300 {
        color: #ca8a04;
      }
      .light-mode .hover\:text-yellow-300:hover {
        color: #ca8a04;
      }
      .light-mode .hover\:text-yellow-400:hover {
        color: #a16207;
      }
      .light-mode .border-white\/20 {
        border-color: rgba(0, 0, 0, 0.1);
      }
      .light-mode .bg-white\/10 {
        background-color: rgba(0, 0, 0, 0.05);
      }
      .light-mode .bg-white\/20 {
        background-color: rgba(0, 0, 0, 0.05);
      }
      .light-mode .hover\:bg-white\/20:hover {
        background-color: rgba(0, 0, 0, 0.1);
      }
      .light-mode .placeholder-gray-300::placeholder {
        color: #6b7280;
      }
      .light-mode #locket path {
        fill: url(#goldGradientDark);
      }
      .light-mode .google-btn {
        background-color: #f3f4f6;
        color: #1f2937;
      }
      .light-mode .google-btn:hover {
        background-color: #e5e7eb;
      }
      .light-mode .auth-tab.active {
        color: #ca8a04;
        border-color: #ca8a04;
      }

      .correct-answer {
        background: rgba(74, 222, 128, 0.5) !important;
        border-color: rgba(74, 222, 128, 0.8) !important;
      }
      .incorrect-answer {
        background: rgba(248, 113, 113, 0.5) !important;
        border-color: rgba(248, 113, 113, 0.8) !important;
      }
      .choice-btn {
        transition: all 0.3s ease;
        cursor: pointer;
      }
      .choice-btn:hover:not(:disabled) {
        transform: translateY(-5px) scale(1.05);
      }
      .selected {
        transform: scale(1.1);
        background: rgba(255, 255, 255, 0.3);
        border-width: 2px;
        border-color: rgba(255, 255, 255, 0.5);
      }
      .correct-position {
        background: rgba(74, 222, 128, 0.5) !important;
        border-color: rgba(74, 222, 128, 0.8) !important;
      }
      .button-ready {
        background-color: #4ade80 !important;
        color: #172554 !important;
        font-weight: 700;
      }
      .input-correct {
        border-color: #4ade80;
        color: #4ade80;
      }
      .input-incorrect {
        border-color: #f87171;
        color: #f87171;
      }
      #locket-container {
        cursor: pointer;
        width: 150px;
        margin: 0 auto 1.5rem auto;
      }
      #locket {
        transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        transform-origin: center bottom;
        animation: pulse 2s infinite;
      }
      #locket.unlocked #heart-left {
        transform: rotate(-45deg) translateX(-25px) translateY(-25px);
      }
      #locket.unlocked #heart-right {
        transform: rotate(45deg) translateX(25px) translateY(-25px);
      }
      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }
      .auth-tab {
        cursor: pointer;
        padding: 0.5rem 1rem;
        border-bottom: 2px solid transparent;
        transition: all 0.3s ease;
      }
      .auth-tab.active {
        border-color: #fde047;
        color: #fde047;
      }
      #notification {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translate(-50%, 200%);
        transition: transform 0.5s ease-in-out;
        z-index: 100;
      }
      #notification.show {
        transform: translate(-50%, 0);
      }
       /* Loading Overlay */
      #loader {
        position: fixed;
        inset: 0;
        z-index: 110;
        background-color: rgba(0,0,0,0.7);
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #loader.hidden {
        display: none;
      }
      .spinner {
        width: 56px;
        height: 56px;
        border: 7px solid;
        border-color: #fde047 transparent;
        border-radius: 50%;
        display: inline-block;
        box-sizing: border-box;
        animation: rotation 1s linear infinite;
      }
      @keyframes rotation {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body class="gradient-bg text-white overflow-x-hidden">
    <!-- Loader -->
    <div id="loader" class="hidden">
      <div class="spinner"></div>
    </div>
    
    <!-- Notification -->
    <div
      id="notification"
      class="glasmorphism py-2 px-6 rounded-full text-center"
    >
      <p id="notification-text"></p>
    </div>

    <!-- Sidebar Menu -->
    <div
      id="sidebar"
      class="sidebar fixed top-0 left-0 h-full w-24 glasmorphism p-6 z-30 transform -translate-x-full"
    >
      <nav class="flex flex-col space-y-8 items-center mt-8">
        <a
          href="#"
          class="hover:text-yellow-300 transition-colors"
          title="My Profile"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-8 w-8"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
            />
          </svg>
        </a>
        <a
          href="#"
          class="hover:text-yellow-300 transition-colors"
          title="Contact Us"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-8 w-8"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
            />
          </svg>
        </a>
        <a
          href="#"
          class="hover:text-yellow-300 transition-colors"
          title="Settings"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-8 w-8"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
            />
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
            />
          </svg>
        </a>
        <button
          id="theme-toggle-btn"
          class="hover:text-yellow-300 transition-colors"
          title="Toggle Theme"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-8 w-8"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
            />
          </svg>
        </button>
        <button
          id="login-menu-btn"
          class="hover:text-yellow-300 transition-colors"
          title="Login"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-8 w-8"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"
            />
          </svg>
        </button>
        <button
          id="logout-btn"
          class="hidden hover:text-yellow-300 transition-colors"
          title="Logout"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-8 w-8"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
            />
          </svg>
        </button>
      </nav>
    </div>
    <div
      id="backdrop"
      class="backdrop fixed top-0 left-0 w-full h-full bg-black/50 z-20 opacity-0 pointer-events-none"
    ></div>

    <!-- Main Content -->
    <div
      class="min-h-screen flex flex-col items-center justify-center p-4 relative overflow-y-auto"
    >
      <button id="menu-btn" class="absolute top-5 left-5 z-10">
        <svg
          class="w-8 h-8"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"
          ></path>
        </svg>
      </button>

      <!-- Welcome Screen -->
      <div id="welcome-screen" class="w-full max-w-xs mx-auto text-center">
        <div id="locket-container" title="Click to Begin" tabindex="0">
          <svg
            id="locket"
            viewBox="0 0 100 100"
            xmlns="http://www.w3.org/2000/svg"
          >
            <defs>
              <linearGradient
                id="goldGradient"
                x1="0%"
                y1="0%"
                x2="100%"
                y2="100%"
              >
                <stop
                  offset="0%"
                  style="stop-color: #fef08a; stop-opacity: 1"
                />
                <stop
                  offset="100%"
                  style="stop-color: #fde047; stop-opacity: 1"
                />
              </linearGradient>
              <linearGradient
                id="goldGradientDark"
                x1="0%"
                y1="0%"
                x2="100%"
                y2="100%"
              >
                <stop
                  offset="0%"
                  style="stop-color: #b45309; stop-opacity: 1"
                />
                <stop
                  offset="100%"
                  style="stop-color: #f59e0b; stop-opacity: 1"
                />
              </linearGradient>
            </defs>
            <g id="heart-halves">
              <path
                id="heart-left"
                fill="url(#goldGradient)"
                d="M50 100 C 40 90, 10 60, 10 40 C 10 20, 30 10, 50 25 V 100 Z"
              />
              <path
                id="heart-right"
                fill="url(#goldGradient)"
                d="M50 100 C 60 90, 90 60, 90 40 C 90 20, 70 10, 50 25 V 100 Z"
              />
            </g>
          </svg>
        </div>
        <p class="mt-4 text-lg font-semibold">Unlock Her Heart</p>
      </div>

      <!-- Level Selection Screen -->
      <div
        id="level-selection-screen"
        class="hidden w-full max-w-xs mx-auto text-center"
      >
        <h1 class="text-3xl md:text-4xl font-bold mb-6">Answer With Caution</h1>
        <div class="space-y-2 flex flex-col items-center">
          <button
            data-level="1"
            class="level-btn glasmorphism w-[150px] text-md font-semibold py-2 px-4 rounded-lg hover:bg-white/20 transition-transform duration-300 transform hover:scale-105 border border-white/30 flex items-center justify-start text-left space-x-3"
          >
            <span>🗝️</span><span>Level 1</span>
          </button>
          <button
            data-level="2"
            id="level-2-btn"
            class="level-btn glasmorphism w-[150px] text-md font-semibold py-2 px-4 rounded-lg hover:bg-white/20 transition-transform duration-300 transform hover:scale-105 border border-white/30 flex items-center justify-start text-left space-x-3 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <span>🤔</span><span>Level 2</span>
          </button>
          <button
            data-level="3"
            id="level-3-btn"
            class="level-btn glasmorphism w-[150px] text-md font-semibold py-2 px-4 rounded-lg hover:bg-white/20 transition-transform duration-300 transform hover:scale-105 border border-white/30 flex items-center justify-start text-left space-x-3 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <span>📊</span><span>Level 3</span>
          </button>
          <button
            data-level="4"
            id="level-4-btn"
            class="level-btn glasmorphism w-[150px] text-md font-semibold py-2 px-4 rounded-lg hover:bg-white/20 transition-transform duration-300 transform hover:scale-105 border border-white/30 flex items-center justify-start text-left space-x-3 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <span>🎭</span><span>Level 4</span>
          </button>
          <button
            data-level="5"
            id="level-5-btn"
            class="level-btn glasmorphism w-[150px] text-md font-semibold py-2 px-4 rounded-lg hover:bg-white/20 transition-transform duration-300 transform hover:scale-105 border border-white/30 flex items-center justify-start text-left space-x-3 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <span>🖼️</span><span>Level 5</span>
          </button>
          <button
            data-level="6"
            id="level-6-btn"
            class="level-btn glasmorphism w-[150px] text-md font-semibold py-2 px-4 rounded-lg hover:bg-white/20 transition-transform duration-300 transform hover:scale-105 border border-white/30 flex items-center justify-start text-left space-x-3 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <span>✍️</span><span>Level 6</span>
          </button>
          <button
            data-level="7"
            id="level-7-btn"
            class="level-btn glasmorphism w-[150px] text-md font-semibold py-2 px-4 rounded-lg hover:bg-white/20 transition-transform duration-300 transform hover:scale-105 border border-white/30 flex items-center justify-start text-left space-x-3 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <span>📜</span><span>Level 7</span>
          </button>
        </div>
      </div>

      <div id="level-1-quiz" class="level-container hidden w-full max-w-md mx-auto">
        <div class="glasmorphism p-6">
          <button
            class="back-to-levels-btn mb-4 text-yellow-300 hover:text-yellow-400"
          >
            &larr; Back to Levels
          </button>
          <div class="level-start text-center">
            <h1 class="text-2xl font-bold mb-4">Keys to Her Heart Trivia</h1>
            <p class="text-gray-200 mb-6">
              One wrong answer sends you back to the start!
            </p>
            <button
              class="level-start-btn glasmorphism text-lg font-semibold py-2 px-8 rounded-full hover:bg-white/20"
            >
              Start
            </button>
          </div>
          <div class="level-question hidden">
            <div class="flex justify-between items-center mb-4 text-md">
              <div class="level-timer-text font-bold">Time: 30</div>
              <div class="font-bold flex items-center">
                <span>❤️</span>
                <span class="level-hearts-count ml-2">0</span>
              </div>
            </div>
            <h2 class="level-question-text text-xl font-semibold mb-6">
              Question text goes here.
            </h2>
            <div class="level-options-container space-y-3"></div>
            <p class="level-progress-text text-sm text-gray-200 mt-6"></p>
          </div>
          <div class="level-end hidden text-center">
            <h2 class="text-2xl font-bold mb-4"></h2>
            <p class="level-score-text text-gray-200 mb-6"></p>
            <button
              class="level-restart-btn glasmorphism text-lg font-semibold py-2 px-8 rounded-full hover:bg-white/20"
            >
              Try Again
            </button>
          </div>
        </div>
      </div>
      <div
        id="level-2-quiz"
        class="level-container hidden w-full max-w-md lg:max-w-4xl mx-auto"
      >
        <div class="glasmorphism p-6 md:p-8 text-center">
          <button
            class="back-to-levels-btn mb-4 text-yellow-300 hover:text-yellow-400"
          >
            &larr; Back to Levels
          </button>
          <div class="level-start">
            <h1 class="text-2xl md:text-4xl font-bold mb-4">
              The Boyfriend Test
            </h1>
            <p class="text-md text-gray-200 mb-8">
              Your choices reveal your dating style. Be honest!
            </p>
            <button
              class="level-start-btn glasmorphism text-xl font-semibold py-3 px-10 rounded-full hover:bg-white/20"
            >
              Start
            </button>
          </div>
          <div class="level-question hidden">
            <p class="level-progress-text mb-4 text-gray-300"></p>
            <h2 class="level-question-text text-2xl font-bold mb-8"></h2>
            <div
              class="level-options-container flex flex-col md:flex-row justify-center items-center gap-6"
            >
             <!-- Options will be dynamically inserted here -->
            </div>
          </div>
          <div class="level-end hidden">
            <h1 class="text-3xl md:text-4xl font-bold mb-4">Your Result!</h1>
            <p
              class="level-result-text text-xl text-yellow-300 font-semibold mb-6"
            ></p>
            <p
              class="level-result-description text-md text-gray-200 mb-8 max-w-2xl mx-auto"
            ></p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
              <button
                class="level-restart-btn glasmorphism text-lg font-semibold py-3 px-8 rounded-full hover:bg-white/20"
              >
                Play Again
              </button>
              <button
                class="level-next-btn glasmorphism text-lg font-semibold py-3 px-8 rounded-full hover:bg-white/20"
              >
                Next Level
              </button>
            </div>
          </div>
        </div>
      </div>
      <div id="level-3-quiz" class="level-container hidden w-full max-w-md mx-auto">
        <div class="glasmorphism p-6">
          <button
            class="back-to-levels-btn mb-4 text-yellow-300 hover:text-yellow-400"
          >
            &larr; Back to Levels
          </button>
          <div class="level-start text-center">
            <h1 class="text-2xl font-bold mb-4">Rank Her Priorities</h1>
            <p class="text-gray-200 mb-6">
              Drag and drop the items into the correct order. One wrong ranking
              ends the game!
            </p>
            <button
              class="level-start-btn glasmorphism text-lg font-semibold py-2 px-8 rounded-full hover:bg-white/20"
            >
              Start
            </button>
          </div>
          <div class="level-question hidden">
            <div class="flex justify-between items-center mb-4 text-md">
              <div class="level-timer-text font-bold">Time: 30</div>
              <div class="font-bold flex items-center">
                <span>❤️</span>
                <span class="level-hearts-count ml-2">0</span>
              </div>
            </div>
            <p
              class="level-progress-text text-sm text-gray-200 mb-4 text-right"
            ></p>
            <h2 class="level-question-text text-xl font-semibold mb-6"></h2>
            <ul class="level-options-container space-y-3 mb-6"></ul>
            <button
              class="level-submit-btn glasmorphism w-full text-lg font-semibold py-3 rounded-lg hover:bg-white/20"
            >
              Lock In Your Answer
            </button>
          </div>
          <div class="level-end hidden text-center">
            <h2 class="text-2xl font-bold mb-4"></h2>
            <p class="level-score-text text-gray-200 mb-6"></p>
            <button
              class="level-restart-btn glasmorphism text-lg font-semibold py-2 px-8 rounded-full hover:bg-white/20"
            >
              Try Again
            </button>
          </div>
        </div>
      </div>
       <div id="level-4-quiz" class="level-container hidden w-full max-w-md mx-auto">
        <div class="glasmorphism p-6">
          <button
            class="back-to-levels-btn mb-4 text-yellow-300 hover:text-yellow-400"
          >
            &larr; Back to Levels
          </button>
          <div class="level-start text-center">
            <h1 class="text-2xl font-bold mb-4">Scenario Showdown</h1>
            <p class="text-gray-200 mb-6">
              Choose the best response. One wrong answer ends the game!
            </p>
            <button
              class="level-start-btn glasmorphism text-lg font-semibold py-2 px-8 rounded-full hover:bg-white/20"
            >
              Start
            </button>
          </div>
          <div class="level-question hidden">
            <div class="flex justify-between items-center mb-4 text-md">
              <div class="level-timer-text font-bold">Time: 30</div>
              <div class="font-bold flex items-center">
                <span>❤️</span>
                <span class="level-hearts-count ml-2">0</span>
              </div>
            </div>
            <h2 class="level-question-text text-xl font-semibold mb-6"></h2>
            <div class="level-options-container space-y-3"></div>
            <p class="level-progress-text text-sm text-gray-200 mt-6"></p>
          </div>
          <div class="level-end hidden text-center">
            <h2 class="text-2xl font-bold mb-4"></h2>
            <p class="level-score-text text-gray-200 mb-6"></p>
            <button
              class="level-restart-btn glasmorphism text-lg font-semibold py-2 px-8 rounded-full hover:bg-white/20"
            >
              Try Again
            </button>
          </div>
        </div>
      </div>
      <div id="level-5-quiz" class="level-container hidden w-full max-w-md mx-auto">
        <div class="glasmorphism p-6">
          <button
            class="back-to-levels-btn mb-4 text-yellow-300 hover:text-yellow-400"
          >
            &larr; Back to Levels
          </button>
          <div class="level-start text-center">
            <h1 class="text-2xl font-bold mb-4">Image Association</h1>
            <p class="text-gray-200 mb-6">
              Choose the word that best represents the image's meaning to a
              woman. One wrong answer ends the game!
            </p>
            <button
              class="level-start-btn glasmorphism text-lg font-semibold py-2 px-8 rounded-full hover:bg-white/20"
            >
              Start
            </button>
          </div>
          <div class="level-question hidden">
            <div class="flex justify-between items-center mb-4 text-md">
              <div class="level-timer-text font-bold">Time: 30</div>
              <div class="font-bold flex items-center">
                <span>❤️</span>
                <span class="level-hearts-count ml-2">0</span>
              </div>
            </div>
            <p
              class="level-progress-text text-sm text-gray-200 mb-4 text-right"
            ></p>
            <div
              class="w-full h-64 md:h-80 rounded-lg mb-6 bg-black/20 flex items-center justify-center"
            >
              <img
                id="level-image-display"
                src=""
                alt="Relationship concept image"
                class="max-w-full max-h-full rounded-lg object-contain"
              />
            </div>
            <div class="level-options-container grid grid-cols-2 gap-4"></div>
          </div>
          <div class="level-end hidden text-center">
            <h2 class="text-2xl font-bold mb-4"></h2>
            <p class="level-score-text text-gray-200 mb-6"></p>
            <button
              class="level-restart-btn glasmorphism text-lg font-semibold py-2 px-8 rounded-full hover:bg-white/20"
            >
              Try Again
            </button>
          </div>
        </div>
      </div>
      <div id="level-6-quiz" class="level-container hidden w-full max-w-md mx-auto">
        <div class="glasmorphism p-6">
          <button
            class="back-to-levels-btn mb-4 text-yellow-300 hover:text-yellow-400"
          >
            &larr; Back to Levels
          </button>
          <div class="level-start text-center">
            <h1 class="text-2xl font-bold mb-4">Fill in the Blank</h1>
            <p class="text-gray-200 mb-6">
              Type the correct word. Spelling counts, case doesn't. One wrong
              answer ends the game!
            </p>
            <button
              class="level-start-btn glasmorphism text-lg font-semibold py-2 px-8 rounded-full hover:bg-white/20"
            >
              Start
            </button>
          </div>
          <div class="level-question hidden">
            <div class="flex justify-between items-center mb-4 text-md">
              <div class="level-timer-text font-bold">Time: 30</div>
              <div class="font-bold flex items-center">
                <span>❤️</span>
                <span class="level-hearts-count ml-2">0</span>
              </div>
            </div>
            <p
              class="level-progress-text text-sm text-gray-200 mb-4 text-right"
            ></p>
            <div
              class="level-question-text text-xl font-semibold mb-6 text-center"
            ></div>
            <div class="level-hint-container text-center mb-4">
              <button
                class="level-hint-btn text-yellow-300 text-sm hover:text-yellow-200"
              >
                Need a hint?
              </button>
              <p class="level-hint-text text-gray-200 mt-2 hidden"></p>
            </div>
            <form class="level-form">
              <input
                type="text"
                class="level-input w-full p-3 bg-white/20 border-2 border-white/30 rounded-lg placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-yellow-300 text-center text-xl"
                autocomplete="off"
              />
              <button
                type="submit"
                class="glasmorphism w-full text-lg font-semibold py-3 rounded-lg hover:bg-white/20 mt-6"
              >
                Submit Answer
              </button>
            </form>
          </div>
          <div class="level-end hidden text-center">
            <h2 class="text-2xl font-bold mb-4"></h2>
            <p class="level-score-text text-gray-200 mb-6"></p>
            <button
              class="level-restart-btn glasmorphism text-lg font-semibold py-2 px-8 rounded-full hover:bg-white/20"
            >
              Try Again
            </button>
          </div>
        </div>
      </div>
      <div id="level-7-quiz" class="level-container hidden w-full max-w-md mx-auto">
        <div class="glasmorphism p-6">
          <button
            class="back-to-levels-btn mb-4 text-yellow-300 hover:text-yellow-400"
          >
            &larr; Back to Levels
          </button>
          <div class="level-start text-center">
            <h1 class="text-2xl font-bold mb-4">Quote Identification</h1>
            <p class="text-gray-200 mb-6">
              Analyze the quote and choose the best interpretation. One wrong
              answer ends the game!
            </p>
            <button
              class="level-start-btn glasmorphism text-lg font-semibold py-2 px-8 rounded-full hover:bg-white/20"
            >
              Start
            </button>
          </div>
          <div class="level-question hidden">
            <div class="flex justify-between items-center mb-4 text-md">
              <div class="level-timer-text font-bold">Time: 30</div>
              <div class="font-bold flex items-center">
                <span>❤️</span>
                <span class="level-hearts-count ml-2">0</span>
              </div>
            </div>
            <p
              class="level-progress-text text-sm text-gray-200 mb-4 text-right"
            ></p>
            <blockquote
              class="level-question-text text-xl font-semibold mb-6 text-center italic p-4 border-l-4 border-yellow-300"
            ></blockquote>
            <div class="level-options-container space-y-3"></div>
          </div>
          <div class="level-end hidden text-center">
            <h2 class="text-2xl font-bold mb-4"></h2>
            <p class="level-score-text text-gray-200 mb-6"></p>
            <button
              class="level-restart-btn glasmorphism text-lg font-semibold py-2 px-8 rounded-full hover:bg-white/20"
            >
              Try Again
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Auth Modals -->
    <div
      id="auth-modal-container"
      class="fixed inset-0 z-40 items-center justify-center bg-black/60 hidden"
    >
      <!-- Login/Register Modal -->
      <div
        id="login-register-modal"
        class="glasmorphism p-8 rounded-lg w-full max-w-sm mx-auto text-center relative"
      >
        <button
          id="close-auth-modal-btn"
          class="absolute top-3 right-4 text-2xl"
        >
          &times;
        </button>
        <div class="flex justify-center mb-6 border-b border-white/20">
          <button id="login-tab-btn" class="auth-tab active">Login</button>
          <button id="register-tab-btn" class="auth-tab">Register</button>
        </div>

        <!-- Login Form -->
        <div id="login-tab">
          <form id="login-form" class="space-y-4">
            <input
              type="email"
              placeholder="Email"
              class="w-full p-3 bg-white/20 border border-white/30 rounded-lg placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-yellow-300"
              required
              autocomplete="email"
            />
            <input
              type="password"
              placeholder="Password"
              class="w-full p-3 bg-white/20 border border-white/30 rounded-lg placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-yellow-300"
              required
              autocomplete="current-password"
            />
            <div class="flex justify-between items-center text-sm">
              <label class="flex items-center">
                <input type="checkbox" id="remember-me" class="mr-2" /> Remember me
              </label>
              <a
                href="#"
                id="forgot-password-link"
                class="hover:text-yellow-300"
                >Forgot Password?</a
              >
            </div>
            <button
              type="submit"
              class="w-full bg-yellow-400 text-gray-900 font-bold py-3 rounded-lg hover:bg-yellow-500 transition-colors"
            >
              Login
            </button>
          </form>
          <div class="flex items-center my-4">
            <hr class="flex-grow border-white/20" />
            <span class="mx-4 text-sm">OR</span>
            <hr class="flex-grow border-white/20" />
          </div>
          <button
            id="google-signin-btn"
            class="w-full flex items-center justify-center bg-white text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-200"
          >
            <svg class="w-5 h-5 mr-2" viewBox="0 0 48 48">
              <path
                fill="#EA4335"
                d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"
              ></path>
              <path
                fill="#4285F4"
                d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"
              ></path>
              <path
                fill="#FBBC05"
                d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"
              ></path>
              <path
                fill="#34A853"
                d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"
              ></path>
              <path fill="none" d="M0 0h48v48H0z"></path>
            </svg>
            Sign in with Google
          </button>
        </div>

        <!-- Register Form -->
        <div id="register-tab" class="hidden">
          <form id="register-form" class="space-y-4">
            <input
              name="username"
              type="text"
              placeholder="Username"
              class="w-full p-3 bg-white/20 border border-white/30 rounded-lg placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-yellow-300"
              required
              autocomplete="username"
            />
            <input
              name="email"
              type="email"
              placeholder="Email"
              class="w-full p-3 bg-white/20 border border-white/30 rounded-lg placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-yellow-300"
              required
              autocomplete="email"
            />
            <input
              name="password"
              type="password"
              placeholder="Password"
              class="w-full p-3 bg-white/20 border border-white/30 rounded-lg placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-yellow-300"
              required
              autocomplete="new-password"
            />
            <button
              type="submit"
              class="w-full bg-yellow-400 text-gray-900 font-bold py-3 rounded-lg hover:bg-yellow-500 transition-colors"
            >
              Register
            </button>
          </form>
        </div>
      </div>

      <!-- Forgot Password Modal -->
      <div
        id="recover-modal"
        class="hidden glasmorphism p-8 rounded-lg w-full max-w-sm mx-auto text-center relative"
      >
        <button
          id="close-recover-modal-btn"
          class="absolute top-3 right-4 text-2xl"
        >
          &times;
        </button>
        <button
          id="back-to-login-btn"
          class="absolute top-4 left-4 text-yellow-300 hover:text-yellow-400"
        >
          &larr; Back
        </button>
        <h2 class="text-2xl font-bold mb-6">Recover Password</h2>
        <form id="recover-form" class="space-y-4">
          <p class="text-gray-200 text-sm mb-4">
            Enter your email and we'll send you a link to reset your password.
          </p>
          <input
            type="email"
            placeholder="Email"
            class="w-full p-3 bg-white/20 border border-white/30 rounded-lg placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-yellow-300"
            required
            autocomplete="email"
          />
          <button
            type="submit"
            class="w-full bg-yellow-400 text-gray-900 font-bold py-3 rounded-lg hover:bg-yellow-500 transition-colors"
          >
            Send Recovery Link
          </button>
        </form>
      </div>

       <!-- Confirmation Modal -->
      <div id="confirmation-modal" class="fixed inset-0 z-50 items-center justify-center bg-black/60 hidden">
        <div class="glasmorphism p-8 rounded-lg w-full max-w-sm mx-auto text-center relative">
          <h2 id="confirmation-title" class="text-2xl font-bold mb-4">Are you sure?</h2>
          <p id="confirmation-message" class="text-gray-200 mb-6">Do you really want to log out?</p>
          <div class="flex justify-center gap-4">
            <button id="confirm-cancel-btn" class="glasmorphism text-lg font-semibold py-2 px-8 rounded-full hover:bg-white/20">Cancel</button>
            <button id="confirm-action-btn" class="bg-red-500 text-white text-lg font-semibold py-2 px-8 rounded-full hover:bg-red-600">Confirm</button>
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      // Firebase Imports
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import {
        getAuth,
        signInAnonymously,
        signInWithEmailAndPassword,
        createUserWithEmailAndPassword,
        sendPasswordResetEmail,
        GoogleAuthProvider,
        signInWithPopup,
        signOut,
        onAuthStateChanged,
        EmailAuthProvider,
        linkWithCredential,
        setPersistence,
        browserLocalPersistence,
        browserSessionPersistence
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
      import {
        getFirestore,
        doc,
        getDoc,
        setDoc,
        onSnapshot,
        deleteDoc
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

      document.addEventListener("DOMContentLoaded", async () => {
        const TIME_LIMIT = 30;

        // --- FIREBASE SETUP ---
        const firebaseConfig = {
          apiKey: "AIzaSyDU9owxGAoTm38iK_loCpHH7jN5Uo2-sDs",
          authDomain: "quest4love-e9e23.firebaseapp.com",
          projectId: "quest4love-e9e23",
          storageBucket: "quest4love-e9e23.appspot.com",
          messagingSenderId: "842502840406",
          appId: "1:842502840406:web:16bab3bf2405a799dddbf7",
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // --- GLOBAL APP STATE ---
        const gameState = {
            userId: null,
            progressUnsubscribe: null,
            totalHearts: 0,
            unlockedLevels: { 2: false, 3: false, 4: false, 5: false, 6: false, 7: false },
        };

        // --- DOM ELEMENT REFERENCES ---
        const ui = {
            loader: document.getElementById('loader'),
            notification: document.getElementById("notification"),
            notificationText: document.getElementById("notification-text"),
            welcomeScreen: document.getElementById("welcome-screen"),
            levelSelectionScreen: document.getElementById("level-selection-screen"),
            locketContainer: document.getElementById("locket-container"),
            locket: document.getElementById("locket"),
            menuBtn: document.getElementById("menu-btn"),
            sidebar: document.getElementById("sidebar"),
            backdrop: document.getElementById("backdrop"),
            loginMenuBtn: document.getElementById("login-menu-btn"),
            logoutBtn: document.getElementById("logout-btn"),
            themeToggleBtn: document.getElementById("theme-toggle-btn"),
            authModalContainer: document.getElementById("auth-modal-container"),
            loginRegisterModal: document.getElementById("login-register-modal"),
            recoverModal: document.getElementById("recover-modal"),
            closeAuthModalBtn: document.getElementById("close-auth-modal-btn"),
            closeRecoverModalBtn: document.getElementById("close-recover-modal-btn"),
            backToLoginBtn: document.getElementById("back-to-login-btn"),
            loginTabBtn: document.getElementById("login-tab-btn"),
            registerTabBtn: document.getElementById("register-tab-btn"),
            loginTab: document.getElementById("login-tab"),
            registerTab: document.getElementById("register-tab"),
            loginForm: document.getElementById("login-form"),
            registerForm: document.getElementById("register-form"),
            recoverForm: document.getElementById("recover-form"),
            forgotPasswordLink: document.getElementById("forgot-password-link"),
            googleSignInBtn: document.getElementById("google-signin-btn"),
            levelContainers: document.querySelectorAll(".level-container"),
            confirmationModal: document.getElementById('confirmation-modal'),
            confirmActionBtn: document.getElementById('confirm-action-btn'),
            confirmCancelBtn: document.getElementById('confirm-cancel-btn'),
            rememberMeCheckbox: document.getElementById('remember-me')
        };

        // --- HELPER FUNCTIONS ---
        const showLoader = () => ui.loader.classList.remove('hidden');
        const hideLoader = () => ui.loader.classList.add('hidden');

        function showNotification(message, isError = false) {
          ui.notificationText.textContent = message;
          ui.notification.className = `glasmorphism py-2 px-6 rounded-full text-center ${
            isError ? "bg-red-500/80" : "bg-green-500/80"
          } text-white show`;
          setTimeout(() => {
            ui.notification.classList.remove("show");
          }, 3000);
        }
        
        function showConfirmationModal(callback) {
            ui.confirmationModal.classList.remove('hidden');
            ui.confirmationModal.classList.add('flex');

            ui.confirmActionBtn.onclick = () => {
                callback(true);
                hideConfirmationModal();
            };
            ui.confirmCancelBtn.onclick = () => {
                callback(false);
                hideConfirmationModal();
            };
        }

        function hideConfirmationModal() {
            ui.confirmationModal.classList.add('hidden');
            ui.confirmationModal.classList.remove('flex');
        }


        // --- Screen Navigation ---
        function showScreen(screen) {
          ui.welcomeScreen.classList.add("hidden");
          ui.levelSelectionScreen.classList.add("hidden");
          ui.levelContainers.forEach((s) => s.classList.add("hidden"));
          if (screen) screen.classList.remove("hidden");
        }

        function showLevelSelectionScreen() {
          updateLevelButtons();
          showScreen(ui.levelSelectionScreen);
        }
        
        function updateLevelButtons() {
            for (let i = 2; i <= 7; i++) {
                const btn = document.getElementById(`level-${i}-btn`);
                if(btn) btn.disabled = !gameState.unlockedLevels[i];
            }
        }

        // --- AUTH, THEME & SIDEBAR LOGIC ---
        const toggleMenu = (open) => {
          if (open) {
            ui.sidebar.classList.remove("-translate-x-full");
            ui.backdrop.classList.remove("opacity-0", "pointer-events-none");
          } else {
            ui.sidebar.classList.add("-translate-x-full");
            ui.backdrop.classList.add("opacity-0", "pointer-events-none");
          }
        };
        const showAuthModal = (show = true) => {
          ui.authModalContainer.classList.toggle("hidden", !show);
          ui.authModalContainer.classList.toggle("flex", show);
          ui.loginRegisterModal.classList.toggle("hidden", !show);
          ui.recoverModal.classList.add("hidden");
        };

        // --- FIREBASE AUTH HANDLERS ---
        const appId = "quest4love-app";

        onAuthStateChanged(auth, (user) => {
          if (user) {
            gameState.userId = user.uid;
            ui.loginMenuBtn.classList.toggle('hidden', !user.isAnonymous);
            ui.logoutBtn.classList.toggle('hidden', user.isAnonymous);
            getUserProgress(user.uid);
          } else {
            // No user is signed in, so we sign them in anonymously.
            signInAnonymously(auth).catch(error => {
                console.error("Anonymous sign-in failed:", error);
                showNotification("Could not start guest session.", true);
            });
          }
        });

        // --- FIRESTORE DATA HANDLING ---
        function getUserProgress(uid) {
          if (!uid) return;
          const progressRef = doc(db, "artifacts", appId, "users", uid);
          gameState.progressUnsubscribe = onSnapshot(progressRef, (docSnap) => {
            if (docSnap.exists()) {
              const data = docSnap.data();
              gameState.totalHearts = data.totalHearts || 0;
              const unlocked = data.unlockedLevels || {};
              for (let i = 2; i <= 7; i++) {
                gameState.unlockedLevels[i] = unlocked[i] || false;
              }
            } else {
              updateUserProgress(uid, {
                username: auth.currentUser.displayName || "Guest",
                totalHearts: 0,
                unlockedLevels: { 2: false, 3: false, 4: false, 5: false, 6: false, 7: false },
              });
            }
            updateLevelButtons();
          });
        }

        async function saveProgress() {
          if (!gameState.userId) return;
          showLoader();
          const progressData = {
            totalHearts: gameState.totalHearts,
            unlockedLevels: gameState.unlockedLevels,
          };
          await updateUserProgress(gameState.userId, progressData);
          hideLoader();
        }

        async function updateUserProgress(uid, data) {
          if (!uid) return;
          const progressRef = doc(db, "artifacts", appId, "users", uid);
          try {
            await setDoc(progressRef, data, { merge: true });
          } catch (error) {
            console.error("Error updating progress:", error);
            showNotification("Failed to save progress.", true);
          }
        }
        
        async function mergeAnonymousAccount(credential) {
            showLoader();
            const anonymousUser = auth.currentUser;
            const anonymousUserId = anonymousUser.uid;
            const anonymousUserDataRef = doc(db, "artifacts", appId, "users", anonymousUserId);

            try {
                const anonymousProgressSnap = await getDoc(anonymousUserDataRef);
                const progressToMerge = anonymousProgressSnap.exists() ? anonymousProgressSnap.data() : {};

                const linkResult = await linkWithCredential(anonymousUser, credential);
                const newPermanentUser = linkResult.user;

                if (progressToMerge) {
                    await updateUserProgress(newPermanentUser.uid, progressToMerge);
                }

                await deleteDoc(anonymousUserDataRef);

                showNotification('Account linked and progress saved!');
            } catch (error) {
                showNotification(`Error linking accounts: ${error.message}`, true);
            } finally {
                hideLoader();
            }
        }

        function resetLocalProgress() {
            gameState.totalHearts = 0;
            gameState.unlockedLevels = { 2: false, 3: false, 4: false, 5: false, 6: false, 7: false };
            updateLevelButtons();
        }

        // --- EVENT LISTENERS ---
        ui.menuBtn.addEventListener("click", (e) => { e.stopPropagation(); toggleMenu(true); });
        ui.backdrop.addEventListener("click", () => toggleMenu(false));
        ui.loginMenuBtn.addEventListener("click", () => { showAuthModal(true); toggleMenu(false); });
        ui.closeAuthModalBtn.addEventListener("click", () => showAuthModal(false));
        ui.themeToggleBtn.addEventListener("click", () => document.body.classList.toggle("light-mode"));
        ui.loginTabBtn.addEventListener("click", () => {
          ui.loginTab.classList.remove("hidden");
          ui.registerTab.classList.add("hidden");
          ui.loginTabBtn.classList.add("active");
          ui.registerTabBtn.classList.remove("active");
        });
        ui.registerTabBtn.addEventListener("click", () => {
          ui.loginTab.classList.add("hidden");
          ui.registerTab.classList.remove("hidden");
          ui.loginTabBtn.classList.remove("active");
          ui.registerTabBtn.classList.add("active");
        });
        ui.forgotPasswordLink.addEventListener("click", (e) => {
          e.preventDefault();
          ui.loginRegisterModal.classList.add("hidden");
          ui.recoverModal.classList.remove("hidden");
        });
        ui.backToLoginBtn.addEventListener("click", () => {
          ui.recoverModal.classList.add("hidden");
          ui.loginRegisterModal.classList.remove("hidden");
        });
        ui.closeRecoverModalBtn.addEventListener("click", () => showAuthModal(false));
        
        const startApp = () => {
          ui.locket.classList.add("unlocked");
          ui.locket.style.animation = "none";
          setTimeout(() => {
            showLevelSelectionScreen();
          }, 600);
        };
        ui.locketContainer.addEventListener("click", startApp);
        ui.locketContainer.addEventListener('keydown', (e) => { if(e.key === 'Enter' || e.key === ' ') startApp() });


        document.querySelectorAll(".back-to-levels-btn").forEach(btn => btn.addEventListener("click", showLevelSelectionScreen));
        
        ui.registerForm.addEventListener("submit", async (e) => {
             e.preventDefault();
            const email = e.target.email.value;
            const password = e.target.password.value;
            const username = e.target.username.value;
            showLoader();
            try {
                if (auth.currentUser && auth.currentUser.isAnonymous) {
                    const credential = EmailAuthProvider.credential(email, password);
                    await mergeAnonymousAccount(credential);
                     await updateUserProgress(auth.currentUser.uid, { username });
                } else {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    await updateUserProgress(userCredential.user.uid, { username });
                }
                showAuthModal(false);
                showNotification("Registration successful!");
            } catch (error) {
                showNotification(error.message, true);
            } finally {
                hideLoader();
            }
        });
        
        ui.loginForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const email = e.target.querySelector('input[type="email"]').value;
            const password = e.target.querySelector('input[type="password"]').value;
            const persistence = ui.rememberMeCheckbox.checked ? browserLocalPersistence : browserSessionPersistence;
            
            showLoader();
            try {
                await setPersistence(auth, persistence);
                await signInWithEmailAndPassword(auth, email, password);
                showAuthModal(false);
                showNotification("Login successful!");
            } catch (error) {
                showNotification("Invalid credentials. Please try again.", true);
            } finally {
                hideLoader();
            }
        });
        
        ui.logoutBtn.addEventListener("click", async () => {
             showConfirmationModal(async (confirmed) => {
                if (confirmed) {
                    showLoader();
                    try {
                        await signOut(auth);
                        showNotification("You've been logged out.");
                    } catch (error) {
                        showNotification("Error logging out.", true);
                    } finally {
                        hideLoader();
                    }
                }
            });
        });

        ui.recoverForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const email = e.target.querySelector('input[type="email"]').value;
            showLoader();
            try {
                await sendPasswordResetEmail(auth, email);
                showNotification("Password reset email sent!");
                showAuthModal(false);
            } catch (error) {
                showNotification(error.message, true);
            } finally {
                hideLoader();
            }
        });

        ui.googleSignInBtn.addEventListener("click", async () => {
            const provider = new GoogleAuthProvider();
            showLoader();
            try {
                if (auth.currentUser && auth.currentUser.isAnonymous) {
                    await mergeAnonymousAccount(provider);
                } else {
                    const result = await signInWithPopup(auth, provider);
                    const user = result.user;
                    const progressDoc = await getDoc(doc(db, "artifacts", appId, "users", user.uid));
                    if (!progressDoc.exists()) {
                        await updateUserProgress(user.uid, { username: user.displayName });
                    }
                }
                showAuthModal(false);
                showNotification("Signed in with Google!");
            } catch (error) {
                showNotification(error.message, true);
            } finally {
                hideLoader();
            }
        });
        
        // =================================================================
        // ======================= REFACTORED QUIZ ENGINE ==================
        // =================================================================
        
        const quizEngine = {
            levelData: null,
            currentLevel: 0,
            currentIndex: 0,
            timer: null,
            timeLeft: TIME_LIMIT,
            userChoices: {}, // For personality quiz
            elements: {},
            draggedItem: null,

            startLevel(levelNumber) {
                this.currentLevel = levelNumber;
                this.levelData = levelsData[this.currentLevel];
                this.currentIndex = 0;
                
                const container = document.getElementById(`level-${levelNumber}-quiz`);
                this.elements = {
                    container,
                    startScreen: container.querySelector(".level-start"),
                    questionScreen: container.querySelector(".level-question"),
                    endScreen: container.querySelector(".level-end"),
                    startBtn: container.querySelector(".level-start-btn"),
                    restartBtn: container.querySelector(".level-restart-btn"),
                    nextBtn: container.querySelector(".level-next-btn"),
                    submitBtn: container.querySelector(".level-submit-btn"),
                    questionText: container.querySelector(".level-question-text"),
                    optionsContainer: container.querySelector(".level-options-container"),
                    progressText: container.querySelector(".level-progress-text"),
                    scoreText: container.querySelector(".level-score-text"),
                    timerText: container.querySelector(".level-timer-text"),
                    heartsCount: container.querySelector(".level-hearts-count"),
                    imageDisplay: document.getElementById('level-image-display'),
                    form: container.querySelector(".level-form"),
                    input: container.querySelector(".level-input"),
                    hintBtn: container.querySelector(".level-hint-btn"),
                    hintText: container.querySelector(".level-hint-text"),
                    resultText: container.querySelector('.level-result-text'),
                    resultDescription: container.querySelector('.level-result-description')
                };

                this.elements.startScreen.classList.remove("hidden");
                this.elements.questionScreen.classList.add("hidden");
                this.elements.endScreen.classList.add("hidden");

                this.elements.startBtn.onclick = () => this.beginQuiz();
                this.elements.restartBtn.onclick = () => this.beginQuiz();
                if (this.elements.nextBtn) this.elements.nextBtn.onclick = () => this.startLevel(this.currentLevel + 1);
                
                showScreen(this.elements.container);
            },

            beginQuiz() {
                this.currentIndex = 0;
                if (this.levelData.type === 'personality') {
                    this.userChoices = {};
                    Object.keys(this.levelData.results).forEach(key => this.userChoices[key] = 0);
                } else {
                   // gameState.totalHearts is cumulative, so we don't reset it here.
                   // It's managed globally.
                }

                this.elements.startScreen.classList.add("hidden");
                this.elements.endScreen.classList.add("hidden");
                this.elements.questionScreen.classList.remove("hidden");
                
                this.displayQuestion();
            },

            displayQuestion() {
                clearInterval(this.timer);
                this.timeLeft = TIME_LIMIT;
                const questionData = this.levelData.questions[this.currentIndex];

                if (this.elements.timerText) {
                    this.elements.timerText.textContent = `Time: ${this.timeLeft}`;
                    this.timer = setInterval(() => {
                        this.timeLeft--;
                        this.elements.timerText.textContent = `Time: ${this.timeLeft}`;
                        if (this.timeLeft <= 0) {
                            this.handleAnswer(null); // Timeout is a wrong answer
                        }
                    }, 1000);
                }
                
                if(this.elements.heartsCount) this.elements.heartsCount.textContent = gameState.totalHearts;
                if(this.elements.progressText) this.elements.progressText.textContent = `Question ${this.currentIndex + 1} of ${this.levelData.questions.length}`;
                if(this.elements.questionText) this.elements.questionText.textContent = questionData.question || questionData.scenario || questionData.sentence || questionData.quote;

                this.elements.optionsContainer.innerHTML = "";

                // Render based on level type
                switch(this.levelData.type) {
                    case 'mcq':
                    case 'scenario':
                    case 'image':
                    case 'quote':
                        questionData.options.forEach((option, index) => {
                            const button = document.createElement("button");
                            button.textContent = option;
                            button.classList.add("w-full", "p-3", "border", "rounded-lg", "text-left", "transition-colors", "duration-200", "border-white/20", "hover:bg-white/10");
                            if (this.levelData.type === 'image') button.classList.add('text-center', 'font-semibold');
                            button.dataset.index = index;
                            button.onclick = (e) => this.handleAnswer(parseInt(e.target.dataset.index));
                            this.elements.optionsContainer.appendChild(button);
                        });
                        if(this.levelData.type === 'image') this.elements.imageDisplay.src = questionData.image;
                        break;
                    case 'personality':
                         const buttonA = document.createElement("button");
                         buttonA.textContent = questionData.choiceA;
                         buttonA.classList.add("choice-btn", "glasmorphism", "w-full", "md:w-64", "h-48", "md:h-64", "flex", "items-center", "justify-center", "p-6", "rounded-2xl", "text-xl", "font-bold");
                         buttonA.onclick = () => this.handleAnswer('A');

                         const orSpan = document.createElement('span');
                         orSpan.textContent = "OR";
                         orSpan.classList.add('text-2xl', 'font-bold');

                         const buttonB = document.createElement("button");
                         buttonB.textContent = questionData.choiceB;
                         buttonB.classList.add("choice-btn", "glasmorphism", "w-full", "md:w-64", "h-48", "md:h-64", "flex", "items-center", "justify-center", "p-6", "rounded-2xl", "text-xl", "font-bold");
                         buttonB.onclick = () => this.handleAnswer('B');
                         
                         this.elements.optionsContainer.append(buttonA, orSpan, buttonB);
                        break;
                    case 'rank':
                        const shuffledItems = [...questionData.items].sort(() => Math.random() - 0.5);
                        shuffledItems.forEach(itemText => {
                            const li = document.createElement('li');
                            li.textContent = itemText;
                            li.draggable = true;
                            li.classList.add("p-4", "bg-white/10", "rounded-lg", "cursor-grab", "border", "border-white/20");
                            this.addDragAndTouchListeners(li);
                            this.elements.optionsContainer.appendChild(li);
                        });
                        this.elements.submitBtn.onclick = () => this.handleAnswer(null); // Submit triggers handleAnswer
                        this.elements.submitBtn.classList.remove('button-ready');
                        break;
                    case 'fill':
                        this.elements.questionText.innerHTML = questionData.sentence.replace("____", `<span class="text-yellow-300">____</span>`);
                        this.elements.input.value = '';
                        this.elements.input.classList.remove('input-correct', 'input-incorrect');
                        this.elements.input.disabled = false;
                        this.elements.form.querySelector('button').disabled = false;
                        this.elements.hintText.classList.add('hidden');
                        this.elements.hintBtn.classList.remove('hidden');
                        this.elements.hintText.textContent = `Hint: ${questionData.hint}`;
                        this.elements.hintBtn.onclick = () => {
                            this.elements.hintText.classList.remove('hidden');
                            this.elements.hintBtn.classList.add('hidden');
                        };
                        this.elements.form.onsubmit = (e) => {
                            e.preventDefault();
                            this.handleAnswer(this.elements.input.value);
                        };
                        this.elements.input.focus();
                        break;
                }
            },
            
            handleAnswer(answer) {
                clearInterval(this.timer);
                const questionData = this.levelData.questions[this.currentIndex];
                let isCorrect = false;

                switch(this.levelData.type) {
                    case 'personality':
                        const resultType = answer === 'A' ? questionData.resultA : questionData.resultB;
                        this.userChoices[resultType]++;
                        this.currentIndex++;
                        if (this.currentIndex < this.levelData.questions.length) {
                           setTimeout(() => this.displayQuestion(), 800);
                        } else {
                           setTimeout(() => this.endQuiz(true), 800);
                        }
                        return; // Exit function early for personality quiz
                    case 'rank':
                        const currentOrder = [...this.elements.optionsContainer.querySelectorAll("li")].map(li => li.textContent);
                        isCorrect = JSON.stringify(currentOrder) === JSON.stringify(questionData.correctOrder);
                        break;
                    case 'fill':
                         isCorrect = answer.trim().toLowerCase() === questionData.answer.toLowerCase();
                         this.elements.input.disabled = true;
                         this.elements.form.querySelector('button').disabled = true;
                         if(!isCorrect) this.elements.input.value = `Correct: ${questionData.answer}`;
                        break;
                    default: // MCQ, scenario, image, quote
                        isCorrect = answer === questionData.correct;
                        const buttons = this.elements.optionsContainer.querySelectorAll('button');
                        buttons.forEach(b => b.disabled = true);
                        if(answer !== null) buttons[answer].classList.add(isCorrect ? 'correct-answer' : 'incorrect-answer');
                        if(!isCorrect) buttons[questionData.correct].classList.add('correct-answer');
                        break;
                }

                if (isCorrect) {
                    gameState.totalHearts++;
                    if(this.elements.heartsCount) this.elements.heartsCount.textContent = gameState.totalHearts;
                    setTimeout(() => {
                        this.currentIndex++;
                        if (this.currentIndex < this.levelData.questions.length) {
                            this.displayQuestion();
                        } else {
                            this.endQuiz(true);
                        }
                    }, 1500);
                } else {
                    setTimeout(() => this.endQuiz(false, `You failed at question ${this.currentIndex + 1}.`), 2000);
                }
            },

            async endQuiz(isWin, message = "") {
                this.elements.questionScreen.classList.add("hidden");
                this.elements.endScreen.classList.remove("hidden");
                const endTitle = this.elements.endScreen.querySelector("h2");
                const scoreText = this.elements.scoreText || this.elements.resultText;
                
                if (this.levelData.type === 'personality') {
                    let maxScore = 0;
                    let finalResult = Object.keys(this.userChoices)[0];
                    for (const type in this.userChoices) {
                        if (this.userChoices[type] > maxScore) {
                            maxScore = this.userChoices[type];
                            finalResult = type;
                        }
                    }
                    this.elements.resultText.textContent = this.levelData.results[finalResult].title;
                    this.elements.resultDescription.textContent = this.levelData.results[finalResult].description;
                    isWin = true; // Personality quiz is always a "win"
                }

                if (isWin) {
                    if (endTitle) endTitle.textContent = this.levelData.winTitle;
                    if(scoreText) scoreText.textContent = this.levelData.winMessage.replace('{hearts}', gameState.totalHearts);

                    const nextLevel = this.currentLevel + 1;
                    if (nextLevel <= 7) {
                       gameState.unlockedLevels[nextLevel] = true;
                    }
                    await saveProgress();

                    if (this.levelData.type === 'personality') {
                         this.elements.restartBtn.textContent = "Play Again";
                         this.elements.restartBtn.onclick = () => this.beginQuiz();
                    } else {
                        this.elements.restartBtn.textContent = nextLevel <= 7 ? "Next Level" : "Play Again From Start";
                        this.elements.restartBtn.onclick = nextLevel <= 7 ? () => this.startLevel(nextLevel) : showLevelSelectionScreen;
                    }
                } else {
                    if (endTitle) endTitle.textContent = "Game Over!";
                    if(scoreText) scoreText.textContent = message;
                    this.elements.restartBtn.textContent = "Try Again";
                    this.elements.restartBtn.onclick = () => this.beginQuiz();
                }
            },

            addDragAndTouchListeners(item) {
                // Mouse Events
                item.addEventListener("dragstart", (e) => this.handleDragStart(e, item));
                item.addEventListener("dragend", (e) => this.handleDragEnd(e, item));
                item.addEventListener('dragover', (e) => this.handleDragOver(e));
                
                // Touch Events
                item.addEventListener("touchstart", (e) => this.handleDragStart(e, item), { passive: true });
                item.addEventListener("touchend", (e) => this.handleDragEnd(e, item));
                item.addEventListener("touchmove", (e) => this.handleDragOver(e), { passive: false });
            },

            handleDragStart(e, item) {
                this.draggedItem = item;
                setTimeout(() => (item.style.opacity = "0.5"), 0);
            },
            
            handleDragEnd() {
                setTimeout(() => {
                    if (this.draggedItem) this.draggedItem.style.opacity = "1";
                    this.draggedItem = null;
                    this.updateRankingVisuals();
                }, 0);
            },

            handleDragOver(e) {
                if (!this.draggedItem) return;
                e.preventDefault();
                const container = this.elements.optionsContainer;
                const y = e.clientY || e.touches[0].clientY;
                const afterElement = this.getDragAfterElement(container, y);
                if (afterElement == null) container.appendChild(this.draggedItem);
                else container.insertBefore(this.draggedItem, afterElement);
            },

            getDragAfterElement(container, y) {
                const draggableElements = [...container.querySelectorAll("li:not(.dragging)")];
                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = y - box.top - box.height / 2;
                    if (offset < 0 && offset > closest.offset) return { offset: offset, element: child };
                    else return closest;
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            },

            updateRankingVisuals() {
                const currentItems = this.elements.optionsContainer.querySelectorAll("li");
                const correctOrder = this.levelData.questions[this.currentIndex].correctOrder;
                let allCorrect = true;
                currentItems.forEach((item, index) => {
                    if (item.textContent !== correctOrder[index]) allCorrect = false;
                });
                this.elements.submitBtn.classList.toggle('button-ready', allCorrect);
            }
        };

        // Initialize all level buttons and add keyboard accessibility
        document.querySelectorAll(".level-btn").forEach(btn => {
            btn.addEventListener("click", () => {
                const level = parseInt(btn.dataset.level);
                quizEngine.startLevel(level);
            });
            btn.addEventListener('keydown', (e) => { if(e.key === 'Enter' || e.key === ' ') btn.click() });
        });
        
        const levelsData = {
          1: { 
              type: 'mcq',
              winTitle: 'Congratulations! Level 1 Complete!',
              winMessage: 'You\'ve passed the first test with {hearts} hearts!',
              questions: [
                { question: "When a woman says 'I'm fine,' what is often the most accurate interpretation?", options: ["She is genuinely okay.", "She is upset but doesn't want to talk about it right now.", "She is testing you to see if you notice something is wrong.", "She is secretly happy."], correct: 2 },
                { question: "What is often considered a woman's primary emotional need in a relationship?", options: ["Financial security", "To feel cherished and emotionally connected", "To have her problems solved for her", "Complete independence"], correct: 1 },
                { question: "She tells you about a problem she's having at work. What is usually the best first response?", options: ["Offer a step-by-step solution.", "Tell her who was wrong in the situation.", "Listen and validate her feelings by saying 'That sounds tough.'", "Distract her with a joke."], correct: 2 },
                { question: "What is a 'bid for connection'?", options: ["Asking for an expensive gift.", "A subtle attempt to get your attention or start a conversation.", "A formal request for a date night.", "A test to see if you're loyal."], correct: 1 },
                { question: "Which of the following is most likely to make a woman feel heard?", options: ["Interrupting to show you understand", "Finishing her sentences for her", "Maintaining eye contact and nodding", "Looking at your phone to Google solutions"], correct: 2 },
                { question: "In communication, women often prioritize...", options: ["Getting to the point quickly", "Exchanging factual information", "Building rapport and emotional connection", "Winning the argument"], correct: 2 },
                { question: "A thoughtful, small gesture often means more than a grand, expensive one because it shows...", options: ["You are good with money", "You are paying attention to her", "You have a lot of free time", "You are trying to impress her"], correct: 1 }
              ] 
          },
          2: {
              type: 'personality',
              winTitle: 'Your Result!',
              winMessage: '', // Not used for personality
              questions: [
                { question: "She seems upset. You're more likely to...", choiceA: "Give her space", choiceB: "Ask what's wrong", resultA: "protector", resultB: "communicator" },
                { question: "The ideal first date is...", choiceA: "Something active and fun", choiceB: "Quiet drinks and conversation", resultA: "adventurer", resultB: "intellectual" },
                { question: "In a disagreement, you focus on...", choiceA: "The facts of the situation", choiceB: "How she is feeling", resultA: "provider", resultB: "communicator" },
                { question: "Her friends are in town. You...", choiceA: "Give her space to be with them", choiceB: "Make an effort to join in", resultA: "protector", resultB: "communicator" },
                { question: "When making a big decision, you...", choiceA: "Present a solution", choiceB: "Explore options together", resultA: "provider", resultB: "intellectual" },
                { question: "You show you care primarily by...", choiceA: "Doing things for her", choiceB: "Telling her how you feel", resultA: "provider", resultB: "communicator" },
                { question: "The best way to spend a weekend is...", choiceA: "Relaxing at home", choiceB: "Going on an adventure", resultA: "protector", resultB: "adventurer" }
              ],
              results: {
                communicator: { title: "The Communicator", description: "You excel at emotional connection. Your strength is listening and creating a safe space for her to share her feelings. She feels seen and heard by you. Your challenge is to remember that sometimes, actions speak louder than words." },
                provider: { title: "The Provider", description: "You are a strong, capable partner who shows love through action and problem-solving. You bring stability and logic to the relationship. She relies on your strength. Remember to also make time to connect with her emotionally, not just practically." },
                protector: { title: "The Protector", description: "You value her peace and independence, and you create a relationship free of pressure. She loves your calm, steady presence. Ensure you're also actively engaging with her world and not just observing from a distance." },
                intellectual: { title: "The Intellectual Partner", description: "You connect on a mental and logical level, enjoying deep conversations and shared ideas. She is drawn to your mind and your perspective. Be sure to also nurture the romantic and emotional side of your connection." },
                adventurer: { title: "The Adventurer", description: "You bring excitement, fun, and new experiences to the relationship. Life with you is never boring. She loves the energy and spontaneity you provide. Make sure to also build moments of quiet, stable connection." }
              }
          },
          3: { 
              type: 'rank',
              winTitle: "Congratulations! You've Mastered Her Priorities!",
              winMessage: "You have a strong understanding of relationship dynamics.",
              questions: [
                { question: "Rank what women often say they look for in a long-term partner (most to least important).", items: ["Sense of Humor", "Kindness & Empathy", "Financial Stability", "Ambition"], correctOrder: ["Kindness & Empathy", "Sense of Humor", "Ambition", "Financial Stability"] },
                { question: "Rank these actions by how much they build emotional safety for her (most to least effective).", items: ["Never raising your voice", "Remembering small details", "Keeping your promises", "Being vulnerable with her"], correctOrder: ["Keeping your promises", "Being vulnerable with her", "Never raising your voice", "Remembering small details"] },
                { question: "Rank these dating turn-offs for many women (from worst to least bad).", items: ["Arrogance", "Poor hygiene", "Being rude to service staff", "Checking your phone constantly"], correctOrder: ["Being rude to service staff", "Arrogance", "Poor hygiene", "Checking your phone constantly"] },
                { question: "She's introducing you to her friends. Rank their likely priorities for judging you (most to least important).", items: ["How you treat her", "Your career success", "Your sense of humor", "Your looks"], correctOrder: ["How you treat her", "Your sense of humor", "Your looks", "Your career success"] },
                { question: "Rank these compliments by their likely impact on her (most to least impactful).", items: ["'You're beautiful.'", "'I love how your mind works.'", "'You're so funny.'", "'You have great style.'"], correctOrder: ["'I love how your mind works.'", "'You're so funny.'", "'You're beautiful.'", "'You have great style.'"] },
                { question: "When she's venting, rank these listening skills by importance (most to least important).", items: ["Validating her feelings", "Offering solutions", "Not interrupting", "Sharing a similar experience"], correctOrder: ["Not interrupting", "Validating her feelings", "Sharing a similar experience", "Offering solutions"] },
                { question: "Rank these first date questions by effectiveness (most effective to least).", items: ["'What do you do for work?'", "'What are you passionate about?'", "'How many siblings do you have?'", "'What's your biggest dream?'"], correctOrder: ["'What are you passionate about?'", "'What's your biggest dream?'", "'What do you do for work?'", "'How many siblings do you have?'"] }
              ] 
          },
          4: { 
              type: 'scenario',
              winTitle: "Congratulations! You're a Scenario Master!",
              winMessage: "You've shown great judgment and emotional intelligence.",
              questions: [
                { scenario: "She comes home from work visibly upset about a colleague. What's the best first move?", options: ["Listen and say, 'That sounds incredibly frustrating.'", "Immediately suggest how she should handle her colleague tomorrow.", "Tell her it's not a big deal and she should forget about it.", "Complain about your own day to show you relate."], correct: 0 },
                { scenario: "You made a mistake and hurt her feelings. How should you apologize?", options: ["'I'm sorry you feel that way.'", "'Look, I said I'm sorry, can we move on?'", "'I'm sorry for [specific action]. I understand why that was hurtful.'", "Buy her a gift and don't mention it again."], correct: 2 },
                { scenario: "She's excited about an accomplishment that seems small to you. Your reaction is to...", options: ["Match her excitement and congratulate her enthusiastically.", "Point out a way she could have done it even better.", "Say 'That's nice,' and change the subject.", "Downplay it so she doesn't get a big ego."], correct: 0 },
                { scenario: "You're planning a date night. What's the best approach?", options: ["Plan something you know she'll love, based on past conversations.", "Just ask her to plan everything.", "Choose a place you want to go and tell her when to be ready.", "Cancel because you're too tired."], correct: 0 },
                { scenario: "She asks, 'Do I look okay in this?' The best response is...", options: ["A simple 'Yes, you look fine.'", "'You look incredible, as always.'", "'Well, the other outfit was better.'", "'Does it really matter what I think?'"], correct: 1 },
                { scenario: "You're out with friends and she seems quiet. You should...", options: ["Ignore her, assuming she's just tired.", "Pull her aside privately and ask if she's okay.", "Loudly ask her in front of everyone why she's being quiet.", "Tell her to be more social and have fun."], correct: 1 },
                { scenario: "She points out a celebrity she finds attractive. You should...", options: ["Get defensive and point out his flaws.", "Agree and say, 'Yeah, he's a good-looking guy.'", "Accuse her of not finding you attractive.", "Give her the silent treatment for the rest of the night."], correct: 1 }
              ] 
          },
          5: { 
              type: 'image',
              winTitle: "Congratulations! You're an Intuition Expert!",
              winMessage: "You've shown a remarkable understanding!",
              questions: [
                  { image: "image1.webp", options: ["Opportunity", "Escape", "Welcome", "Intrusion"], correct: 2 },
                  { image: "image2.webp", options: ["Frustration", "Connection", "Music", "A problem to solve"], correct: 0 },
                  { image: "image3.webp", options: ["Loneliness", "Peace", "Waiting", "Independence"], correct: 1 },
                  { image: "image4.webp", options: ["Sleep", "Laziness", "Security", "Winter"], correct: 2 },
                  { image: "image5.webp", options: ["Getting lost", "Adventure", "A journey together", "Danger"], correct: 2 },
                  { image: "image6.webp", options: ["Isolation", "Guidance", "Warning", "Safety"], correct: 3 },
                  { image: "image7.webp", options: ["Control", "Possession", "Partnership", "Neediness"], correct: 2 }
              ] 
          },
          6: { 
              type: 'fill',
              winTitle: "Congratulations! You're a Wordsmith of Wisdom!",
              winMessage: "You're ready for the final test!",
              questions: [
                { sentence: "When she wants to talk about her feelings, she's usually looking for empathy, not ____.", answer: "solutions", hint: "A fix or an answer." },
                { sentence: "Listening is not just waiting for your turn to ____.", answer: "talk", hint: "The opposite of being silent." },
                { sentence: "A woman often remembers not just what you did, but how you made her ____.", answer: "feel", hint: "An emotion or sensation." },
                { sentence: "For many women, emotional intimacy is a prerequisite for ____ intimacy.", answer: "physical", hint: "Relating to the body." },
                { sentence: "Sometimes, the most powerful thing you can say is ____.", answer: "nothing", hint: "The absence of words." },
                { sentence: "Small, consistent efforts often mean more than grand, infrequent ____.", answer: "gestures", hint: "A movement to express an idea or meaning." },
                { sentence: "The goal of a relationship argument shouldn't be to win, but to ____.", answer: "understand", hint: "To perceive the intended meaning of." }
              ] 
          },
          7: { 
              type: 'quote',
              winTitle: "🏆 CONGRATULATIONS! 🏆",
              winMessage: "You have passed every test with a total of {hearts} hearts and unlocked the secrets to her heart!",
              questions: [
                { quote: "'The real lover is the man who can thrill you by kissing your forehead.' - Marilyn Monroe. What does this mean?", options: ["Forehead kisses are the most passionate.", "He is too shy for a real kiss.", "Emotional intimacy and tenderness are thrilling.", "He is very tall."], correct: 2 },
                { quote: "'A woman's heart should be so hidden in God that a man has to seek Him just to find her.' This quote emphasizes...", options: ["A woman should be difficult to get to know.", "A shared spiritual or moral foundation is key.", "A man must be religious to be a good partner.", "Love should be a mysterious game."], correct: 1 },
                { quote: "'She's not looking for a knight, she's looking for a sword.' - Atticus. This suggests modern women value...", options: ["A partner who empowers them to be strong.", "A man who will fight all their battles for them.", "A partner who is aggressive and dangerous.", "A love of medieval weaponry."], correct: 0 },
                { quote: "'Whatever our souls are made of, his and mine are the same.' - Emily Brontë. This describes what kind of connection?", options: ["A superficial physical attraction.", "A deep, fundamental compatibility.", "A codependent relationship.", "An obsessive love."], correct: 1 },
                { quote: "'He's like a song she can't get out of her head.' This romantic idea can also be a warning sign of...", options: ["A healthy, exciting new love.", "A catchy taste in music.", "Infatuation or obsession, not deep love.", "A perfect match."], correct: 2 },
                { quote: "'A woman is unstoppable after she realizes she deserves better.' How does this apply to a good relationship?", options: ["A good partner helps her realize her worth, he doesn't make her question it.", "You should be afraid of her leaving.", "It's a threat that she will leave if you make a mistake.", "Women are naturally confrontational."], correct: 0 },
                { quote: "'I'm not a prize to be won.' This phrase is a reminder that a relationship is a...", options: ["Competition against other men.", "Partnership of equals.", "Transaction where you must prove your worth.", "Game with a clear winner and loser."], correct: 1 }
              ] 
          }
        };

      });
    </script>
  </body>
</html>

